# 자판기
> 바닐라 자바스크립트로 구현하는 자판기!

<br>

## 1️⃣ 사용한 라이브러리와 버전
### 🗃 랜덤 라이브러리
- `@woowacourse/mission-utils`: 1.0.1
  - CDN으로 설치

<br>

### 🗃 Linter 관련
- `eslint`: 8.3.0
- `eslint-config-airbnb`: 19.0.1
- `eslint-config-prettier`: 8.3.0
- `eslint-plugin-cypress`: 2.12.1
- `eslint-plugin-import`: 2.25.3
- `eslint-plugin-jsx-a11y`: 6.5.1
- `eslint-plugin-prettier`: 4.0.0
- `prettier`: 2.4.1

<br>

## 2️⃣ 구현 단계 정의
> 주어진 [**기능 요구사항**](https://github.com/InSeong-So/javascript-vendingmachine-precourse#-%EA%B8%B0%EB%8A%A5-%EC%9A%94%EA%B5%AC-%EC%82%AC%ED%95%AD)을 따라 작성합니다.

<br>

### 👀 개발 전
기능 요구사항을 확인하기 전에, 수록된 `*.gif` 이미지의 앱 화면을 분석했습니다. 세 개로 구분된 버튼을 누를 때마다 하위 영역이 변경되었고, 버튼 영역은 그대로 였습니다. 따라서 헤더와 메인으로 분리하면 클릭 이벤트에 따라 메인 컨텐츠를 제어할 수 있다고 판단했습니다. 이어 각 form 이벤트를 통해 현황이 갱신되는 모습으로 보아, 메인 내부에서도 레이어를 나누어 부모-자식 관계를 맺고 부모에서는 기능을, 자식에서는 그 결과를 보여주면 될 것 같았습니다.

따라서 구조를 헤더-메인(입력-결과)으로 나누고, 비즈니스 로직은 이벤트를 관리하는 모듈을 작성하여 제어해보기로 했습니다. 분리한 구조의 모듈은 각각 컴포넌트 형태로, 마스터 컴포넌트에 기본 기능을 정의하여 작성한 뒤 이를 상속시키면 효율적으로 모든 컴포넌트에 필요한 기능을 부여할 수 있어 보였습니다. 구조와 관계에 대한 리팩토링은 최소 기능(탭 별 화면 변경)이 구현된 뒤부터 단위 기능 완료 시 진행하는 것으로 생각했습니다.

웹 브라우저 저장소에 데이터를 저장하는 것으로 보아, 해당 웹 브라우저 저장소도 모듈화하여 확실한 책임을 부여하는 것이 등장인물로써 옳아보였습니다. 따라서 Local Storage 관련 모듈을 작성한 뒤 마스터 컴포넌트가 의존하도록 구상합니다.

남은 문제는 비즈니스 로직의 분리였습니다. DOM을 그리게 되면 addEventListener로 등록한 이벤트 핸들러가 중복 등록되어 2번, 3번 실행될 가능성이 있었습니다. 프로퍼티에 이벤트 핸들러를 등록하는 것은 코드 관점에서, 유지보수 관점에서도 지향하지 않아 생각하지 않았습니다. 이 부분은 이벤트를 전담하는 매니저 클래스를 생성하여 각 이벤트를 등록하고 꺼내어 사용하는 것으로 진행하고자 합니다.

<hr>

✍️ 정리하자면, 구현할 앱의 진행 과정은 아래와 같이 나뉩니다.

**1. 각 화면을 html에 그려 DOM 엘리먼트를 확인하기**

<br>

**2. 변하지 않는 헤더, 실제 컨텐츠가 그려지는 메인으로 분리하기**

<br>

**3. 헤더와 메인을 추상화하여 공통점을 분리하기**

<br>

**4. 분리된 공통점을 마스터 컴포넌트로 정의하고, 이벤트 핸들링에 따른 동적 렌더링을 제어하기**
   - 난해하지만 입력 이벤트 ➡️ 결과 출력이라고 생각합니다.
   - 최초에는 구조가 아닌 기능 우선, 그 후 리팩토링을 진행합니다.

<br>

**5. Local Storage를 모듈화하기**
   - form 이벤트에 따른 데이터 저장을 확인합니다.
   - form 이벤트에 따른 데이터 불러오기를 확인합니다.
   - 마스터 컴포넌트와 어떻게 의존할지 고민합니다.

<br>

**6. 렌더링에 의한 이벤트 중복 등록을 방지하기 위해 이벤트를 관리하는 모듈 작성하기**

<br>

**7. 중복된 코드, 기능, 구조가 없는지 확인하고 리팩토링합니다.**

<br>
<hr>

✍️ 구현할 기능은 아래와 같습니다.

**1. 공통**
   - 탭이 가진 정보를 Storage에 저장
   - 탭을 이동할 때 Storage에 저장된 데이터 로드

<br>

**2. 상품 관리 탭 : 자판기에 상품을 추가하는 기능**
   - 최초 상품 목록은 *비어 있는* 상태
   - 상품명(text), 가격(number), 수량(number)을 입력해 `추가하기` 버튼을 클릭하여 상품을 추가
   - 상품 가격은 *100원 이상*, *10 단위*
   - 상품이 추가되면 동적으로 화면에 표시

<br>

**3. 잔돈 충전 탭 : 자판기에 잔돈을 충전하는 기능**
   - 최초 금액은 *0원*, 동전의 개수도 *0개*
   - 충전 금액(number)을 입력해 `충전하기` 버튼을 클릭하여 충전
   - 보유 금액은 `${금액}원` 형식
   - 보유 금액만큼 *무작위*로 동전 생성
   - 동전 개수는 `${개수}개` 형식
   - 누적하여 충전이 가능하며, 추가 충전 금액 또한 무작위로 동전을 생성하여 기존 동전 개수에 추가

<br>

**4. 상품 구매 탭 : 사용자가 금액을 투입하고, 상품을 구매하고, 잔돈을 반환 받는 기능**
   - 최초 충전 금액은 *0원*, 반환된 각 동전의 개수는 *0개*
   - 투입 금액(number)을 입력해 `투입하기` 버튼을 클릭하여 투입
   - 10원으로 나누어 떨어지는 금액만 투입 가능
   - 보유 금액은 `${금액}원` 형식
   - 누적하여 투입이 가능하며, `반환하기` 버튼을 통해 잔돈을 반환 받는 기능
     - 잔돈을 돌려줄 때는 현재 보유한 최소 개수의 동전으로 잔돈 반환(그리디 알고리즘 적용)
     - *지폐를 잔돈으로 반환하는 경우는 없다고 가정*
     - 잔돈을 반환할 수 없는 경우, 잔돈으로 반환할 수 있는 금액만 반환(절삭)
   - 동전 개수는 `${개수}개` 형식

<br>

> 이후 추가 및 수정 부분은 동적으로 적용한 뒤 기록합니다.

<hr>
<br>

### 🛠 환경 설정
> 일관성 있는 코드를 위해 ESLint, Prettier를 설정하고 Airbnb 스타일을 적용한 뒤 추가적인 규칙을 정의합니다.

**사전 정의**
- [x] 의존성 라이브러리를 설치하고 Linter를 설정합니다.

<br>

> 커밋 목록
- [**🔬Chore: 의존성 설치**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/8ac5490434f1387afb905bba5e86e8ea5be43b1b)

<hr>
<br>

## 3️⃣ 구조 구현
### 🛠 화면 그려보기

**사전 정의**
- [x] 각 화면을 html에 그려 DOM 엘리먼트를 확인하기

<br>

> 커밋 목록
- [**🎆Style: link/script 적용**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/d0acbfc34e66fc9a4df0f495664a74b9c1dc4298)
- [**🎆Style: 상품 관리 탭 디자인**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/e5c3d83d2a3a50d76f53c76bda594d8b12df6855)
- [**🎆Style: 잔돈 충전 탭 디자인**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/c0419f1eab6a15fa5feb769815de28259e284b51)
- [**🎆Style: 상품 구매 탭 디자인**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/f32d664097db815c7a4a1799d466161feecbfb9c)

<br>

### 🛠 화면 분리하기

**사전 정의**
- [x] 변하지 않는 헤더, 실제 컨텐츠가 그려지는 메인으로 분리하기

<br>

> 커밋 목록
- [**🎆Style: DOM으로 html 렌더링**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/2d7ffad73730eea037b79e36b599110e50a07834)

<br>

### 🛠 화면을 추상화하기

**사전 정의**
- [x] 헤더와 메인을 추상화하여 공통점을 분리하기

**추가 사항**
- 헤더와 메인을 수평적 관계로 두지 않고 수직적 관계로 제어하는 것이 구조적 관점에서 옳아 보입니다.
  - [x] 헤더는 변경되지 않으므로 이벤트 핸들링까지 보유합니다.
  - [x] 메인은 변경되므로 비즈니스 로직과 UI 렌더링 로직을 분리해야 합니다.
- 메인 컨텐츠가 여러 개이므로 파라미터를 통해 동적으로 제어하는 부분이 필요합니다.
  - [x] `<main></main>` 태그가 아닌 자식 중 최상위 `<div ../>` 태그에 `dataset` 속성을 부여합니다.

<br>

> 커밋 목록
- [**✒️Feat: 화면 추상화**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/a89d7819ac06e4efe50c3866364d24c3e8a67e74)

<br>

### 🛠 구체화하기

**사전 정의**
- [x] 분리된 공통점을 마스터 컴포넌트로 정의하고, 이벤트 핸들링에 따른 동적 렌더링을 제어하기

**추가 사항**
- 헤더(Header)와 메인(Main)은 Container Component(이하 컨테이너)로 정의하고 비즈니스 로직을 갖습니다.
  - 컨테이너는 비즈니스 로직을 담당하며 동작에 대한 역할을 합니다. 따라서 공통된 기능을 상속 받기에 적합합니다.
- 헤더의 메뉴(Menu)와 메인의 컨텐츠(Content)는 Presentational Component(이하 프레젠테이션)로 정의하고 UI를 담당합니다.
  - 프렌젠테이션은 UI만을 담당하며 동적으로 제어하기 위한 파라미터만을 받으므로 순수 함수로 구현합니다.
- 앱을 확장할 수 있는 여지를 남겨두고 싶습니다. nav 하위의 버튼은 그 형태가 비슷하며, 메인을 헤더 버튼에 종속되는 계층으로 설계했기 때문에 상수로 분리할 수 있을 것 같습니다.
  - [x] 컨테이너는 클래스형 컴포넌트로, 프레젠테이션은 함수형 컴포넌트로 작성합니다.
  - [x] 메뉴를 상수로 관리합니다.
  - [x] 엔트리 파일인 index.js에서부터 최상위 > 최하위로 프레젠테이션 컴포넌트의 파라미터로 `앱의 타이틀`, `앱의 메뉴`를 주입하면 보다 효율적으로, 또한 동적으로 관리할 수 있습니다.

<br>

> 커밋 목록
- [**✒️Feat: 추상화 된 구조의 구체화**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/31b8ac287069601d80bcc34a0b63b7f2e5265781)

<br>

### 🛠 Local Storage 모듈화하기

**사전 정의**
- [x] form 이벤트에 따른 데이터 저장/불러오기

**추가 사항**
- 로컬 스토리지를 클래스 모듈로 관리하며, 마스터 컴포넌트의 멤버 변수에 의존성을 주입시킵니다.
- 로컬 스토리지의 아이템 타입은 `Array`로 한정합니다.
- 작성할 Storage 모듈이 가져야 하는 기능은 아래와 같습니다.
  - [x] **C**, 새로운 key, value를 가지는 아이템 생성하기
  - [x] **R**, key로 value 가져오기
  - [x] **U**, key로 value update 하기
  - [x] **D**, 저장된 key, value 아이템을 삭제하기

<br>

> 커밋 목록
- [**✒️Feat: Storage 작성**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/9a4608dbde4189360577708c3caa03e4ad59d32c)

<br>

### 🛠 이벤트 관리 모듈 구현하기

**사전 정의**
- [x] 이벤트를 클래스 모듈로 관리하며 이벤트 위임을 활용하기

**추가 사항**
- 클로저와 call을 활용해봅니다.
- [ ] this 바인딩의 문제로 인자를 추가하여 이벤트를 등록하도록 수정합니다.
- [ ] 파라미터 인자의 개수가 너무 많으므로 이를 수정합니다.

<br>

> 커밋 목록
- [**✒️Feat: 이벤트 모듈 구현**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/8600d4930e0fde4dad5662e959c92b34c2e9cfb0)

<br>

### 🛠 구조 리팩토링하기

**사전 정의**
- [x] 중복된 코드, 기능, 구조가 없는지 확인하기

<br>

> 커밋 목록
- [**✒️Feat: helper 함수 정의**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/d1bea673baefb380f43bdc8afaffffae8d3c9736)
- [**🗃Refactor: 컴포넌트 props 수정**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/33cb8e2d657842b06100a0579d20c092dde35e32)
- [**🗃Refactor: 이벤트 모듈 리팩토링**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/5eccd68c2394a6fcf5c322a6588eee34f51f2b44)
- [**✒️Feat: 이벤트 모듈 주입**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/37baa3253cce1df12191b203af7e2ea38ca0bbcc)

<hr>
<br>

## 4️⃣ 기능 구현
### 🛠 공통

**사전 정의**
- [x] 1. 최초 Storage는 **비어 있는** 상태
- [x] 2. key는 탭의 id, item은 탭에 출력되는 정보로 관리
- [x] 3. 아이템이 없다면 빈 배열을 반환

<br>

> 커밋 목록
- [**🗃Refactor: 구조 리팩토링**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/9f0251be498c2975a51bbcfb5a7fefcecd42ed2b)

<br>

### 🛠 상품 관리 탭

**사전 정의**
- [x] 1. 최초 상품 목록은 **비어 있는** 상태
- [x] 2. 상품명(text), 가격(number), 수량(number)을 입력해 `추가하기` 버튼을 클릭하여 상품을 추가
- [x] 3. 상품 가격은 **100원 이상**, **10 단위**
- [x] 4. 상품이 추가되면 동적으로 화면에 표시
- [x] 5. Storage 기능 확장(subscribe, notify 추가)

**추가 사항**
- 추가된 데이터가 즉시 화면에 반영되기 위해서는 Storage의 데이터 반영 이벤트가 컨테이너에 전달되어야 합니다. 이를 위해 `pub/sub` 패턴을 활용하여 최초 App 컴포넌트가 마운트 될 때 자식 컴포넌트를 등록하여 렌더링하게 합니다.
  - 이 부분은 최적화가 필요하지만, 기능을 우선하고 추후 리팩토링합니다.
- 상품 추가 시 유효성 검사를 진행합니다.
  - [x] 상품명의 앞, 뒤 공백은 제거됩니다.
  - [x] 상품명은 중복 등록될 수 없습니다.
  - [x] 가격은 양의 정수만 입력됩니다.
  - [x] 가격은 100 이상, 10으로 나누어 떨어지는 정수입니다.
  - [x] 수량은 양의 정수만 입력됩니다.
  - [x] 상품명, 가격, 수량은 최대 20자까지 등록하도록 합니다.
  - [x] 상품명, 가격, 수량은 공백일 수 없습니다.
  - [x] 상품명, 가격, 수량의 잘못된 입력값에 대해 alert을 출력하고 값을 비운 뒤 포커싱합니다.

<br>

> 커밋 목록
- [**✒️Feat: 상품 관리 탭 구현**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/dc5e5462cfe73013bc387dca0db4b973cf87c127)
- [**✒️Feat: 유효성 검사 구현 1**](https://github.com/InSeong-So/javascript-vendingmachine-precourse/commit/2d3119a1df2e809492521f0617d46d7ea418248a)

<br>

### 🛠 잔돈 충전 탭

**사전 정의**
- [ ] 1. 최초 금액은 **0원**, 동전의 개수도 **0개**
- [ ] 2. 충전 금액(number)을 입력해 `충전하기` 버튼을 클릭하여 충전
- [ ] 3. 보유 금액은 `${금액}원` 형식
- [ ] 4. 보유 금액만큼 **무작위**로 동전 생성
- [ ] 5. 동전 개수는 `${개수}개` 형식
- [ ] 6. 누적하여 충전이 가능하며, 추가 충전 금액 또한 무작위로 동전을 생성하여 기존 동전 개수에 추가

**추가 사항**
- 해당 컴포넌트는 Storage에 아이템이 존재하지 않아도 기본적인 테이블을 출력해야 합니다. 잔돈을 충전하기 전에는 기본적으로 보유한 잔돈을 보여줍니다.
  - [ ] Storage에 저장된 아이템이 없을 때, 상수 Default 아이템을 적용합니다.
  - [ ] 확장을 위해 동전을 하드코딩하지 않고 객체의 프로퍼티로 관리합니다.
- 유효성 검사는 상품 관리 탭의 `가격, 수량` input의 유효성과 동일하게 가되 `최소, 단위`에 대한 제한이 없으므로 다른 탭에서 지정된 단위(10원)에 따라 절삭합니다. 또한 랜덤 값을 산출하여 각 동전의 개수를 카운트합니다.
  - [ ] 자판기가 보유할 금액은 1의 자리도 입력할 수 있으며 10원 단위가 아니라면 내림합니다.
  - [ ] 잔돈을 계산하는 난수는 `MissionUtils.Random.pickNumberInList` 메서드를 사용합니다.
  - [ ] 유효성 검사는 기존 작성된 함수를 재사용하며, 리팩토링이 가능하므로 상품 구매 텝을 구현하기 전에 수정합니다.

<br>

### 🛠 상품 구매 탭

**사전 정의**
- [ ] 1. 최초 충전 금액은 **0원**, 반환된 각 동전의 개수는 **0개**
- [ ] 2. 투입 금액(number)을 입력해 `투입하기` 버튼을 클릭하여 투입
- [ ] 3. 10원으로 나누어 떨어지는 금액만 투입 가능
- [ ] 4. 보유 금액은 `${금액}원` 형식
- [ ] 5. 누적하여 투입이 가능하며, `반환하기` 버튼을 통해 잔돈을 반환 받는 기능
  - [ ] 잔돈을 돌려줄 때는 현재 보유한 최소 개수의 동전으로 잔돈 반환(그리디 알고리즘 적용)
  - [ ] **지폐를 잔돈으로 반환하는 경우는 없다고 가정**
  - [ ] 잔돈을 반환할 수 없는 경우, 잔돈으로 반환할 수 있는 금액만 반환(절삭)
- [ ] 6. 동전 개수는 `${개수}개` 형식

<hr>
<br>